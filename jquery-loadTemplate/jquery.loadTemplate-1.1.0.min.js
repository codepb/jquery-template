(function(a){var u={},t={},h={};function m(B,x,z){var w=this,v,A,y;x=x||{};A=a.extend({overwriteCache:false,complete:null,success:null,error:function(){a(this).each(function(){a(this).html(A.errorMessage)})},errorMessage:"There was an error loading the template.",paged:false,pageNo:1,elemPerPage:10,append:false,prepend:false},z);if(a.type(x)==="array"){return r.call(this,B,x,A)}if(!g(B)){v=a(B)}y=A.isFile||(typeof A.isFile==="undefined"&&(typeof v==="undefined"||v.length===0));if(y&&!A.overwriteCache&&u[B]){p(B,w,x,A)}else{if(y&&!A.overwriteCache&&u.hasOwnProperty(B)){c(B,w,x,A)}else{if(y){l(B,w,x,A)}else{n(v,w,x,A)}}}return this}function b(w,v){if(v){h[w]=v}else{h=a.extend(h,w)}}function g(v){return typeof v==="string"&&v.indexOf("/")>-1}function r(B,w,z){var v=this,C=w.length,x=0,y;z=z||{};if(z.paged){var A=(z.pageNo-1)*z.elemPerPage;w=w.slice(A,A+z.elemPerPage)}y=a.extend({},z,{complete:function(){v.append(this.html());x++;if(x===C){if(z&&typeof z.complete==="function"){z.complete()}}}});if(!z.append&&!z.prepend){v.html("")}a(w).each(function(){var D=a("<div/>");m.call(D,B,this,y)});return this}function c(y,w,v,x){if(t[y]){t[y].push({data:v,selection:w,settings:x})}else{t[y]=[{data:v,selection:w,settings:x}]}}function p(z,x,w,y){var v=u[z].clone();o.call(x,v,w,y);if(typeof y.success==="function"){y.success()}}function l(z,x,w,y){var v=a("<div/>");u[z]=null;v.load(z,function(A,B){if(B==="error"){j(z,x,w,y)}else{k(v,z,x,w,y)}})}function n(v,y,x,z){var w=a("<div/>");if(v.is("script")){v=a.parseHTML(a.trim(v.html()))}w.html(v);o.call(y,w,x,z);if(typeof z.success==="function"){z.success()}}function o(x,v,w){f(x,v);a(this).each(function(){if(w.append){a(this).append(x.html())}else{if(w.prepend){a(this).prepend(x.html())}else{a(this).html(x.html())}}});if(typeof w.complete==="function"){w.complete.call(a(this))}}function j(y,w,v,x){var z;if(typeof x.error==="function"){x.error.call(w)}a(t[y]).each(function(A,B){if(typeof B.settings.error==="function"){B.settings.error.call(B.selection)}});if(typeof x.complete==="function"){x.complete.call(w)}while(t[y]&&(z=t[y].shift())){if(typeof z.settings.complete==="function"){z.settings.complete.call(z.selection)}}if(typeof t[y]!=="undefined"&&t[y].length>0){t[y]=[]}}function k(v,z,x,w,y){var A;u[z]=v.clone();o.call(x,v,w,y);if(typeof y.success==="function"){y.success.call(x)}while(t[z]&&(A=t[z].shift())){o.call(A.selection,u[z].clone(),A.data,A.settings);if(typeof A.settings.success==="function"){A.settings.success.call(A.selection)}}}function f(w,v){v=v||{};s("data-content",w,v,function(x,y){x.html(e(x,y,"content"))});s("data-content-append",w,v,function(x,y){x.append(e(x,y,"content"))});s("data-content-prepend",w,v,function(x,y){x.prepend(e(x,y,"content"))});s("data-src",w,v,function(x,y){x.attr("src",e(x,y,"src"))},function(x){x.remove()});s("data-alt",w,v,function(x,y){x.attr("alt",e(x,y,"alt"))});s("data-value",w,v,function(x,y){x.val(e(x,y,"value"))});s("data-link",w,v,function(x,z){var y=a("<a/>");y.attr("href",e(x,z,"link"));y.html(x.html());x.html(y)});s("data-link-wrap",w,v,function(x,z){var y=a("<a/>");y.attr("href",e(x,z,"link-wrap"));x.wrap(y)});s("data-options",w,v,function(x,y){a(y).each(function(){var z=a("<option/>");z.attr("value",this).text(this).appendTo(x)})});q(w,v)}function s(v,z,w,x,y){a("["+v+"]",z).each(function(){var A=a(this),B=A.attr(v),C=i(w,B);A.removeAttr(v);if(C&&x){x(A,C)}else{if(y){y(A)}}});return}function q(w,v){a("[data-template-bind]",w).each(function(){var x=a(this),y=a.parseJSON(x.attr("data-template-bind"));x.removeAttr("data-template-bind");a(y).each(function(){var A;if(typeof(this.value)==="object"){A=i(v,this.value.data)}else{A=i(v,this.value)}if(typeof A!=="undefined"&&this.attribute){switch(this.attribute){case"content":x.html(d(A,this));break;case"contentAppend":x.append(d(A,this));break;case"contentPrepend":x.prepend(d(A,this));break;case"options":var z=this;a(A).each(function(){var B=a("<option/>");B.attr("value",this[z.value.value]).text(d(this[z.value.content],z)).appendTo(x)});break;default:x.attr(this.attribute,d(A,this))}}})})}function d(w,v){if(v.formatter&&h[v.formatter]){return h[v.formatter](w,v.formatOptions)}return w}function i(v,w){var x=w.split("."),y,z=v;while((y=x.shift())&&typeof z!=="undefined"){z=z[y]}return z}function e(v,A,w){var z=v.attr("data-format-target"),y;if(z===w||(!z&&w==="content")){y=v.attr("data-format");if(y&&typeof h[y]==="function"){var x=v.attr("data-format-options");return h[y](A,x)}}return A}a.fn.loadTemplate=m;a.addTemplateFormatter=b})(jQuery);